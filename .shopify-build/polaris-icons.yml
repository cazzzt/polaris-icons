containers:
  default:
    docker: circleci/node:10.13.0

# sudo chown stuff is here because `yarn install` tries to symlink the binaries
# defined in packages into node_modules/.bin and then fails if the files
# aren't owned by the current user
shared:
  tests: &build-and-tests
    label: '🎩 Build and Tests'
    container: default
    timeout: 5m
    run:
      - sudo chown -R circleci:circleci node_modules packages/*/bin
      - yarn: ~
      - yarn run build
      - yarn run type-check
      - yarn run test
  lint: &lint
    label: 'Lint'
    container: default
    timeout: 5m
    run:
      - sudo chown -R circleci:circleci node_modules packages/*/bin
      - yarn: ~
      - yarn run lint
steps:
  - <<: *lint
  - <<: *build-and-tests
